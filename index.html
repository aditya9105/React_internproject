<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Entry Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 20px; }
  </style>
</head>
<body>

<div class="container">
  <h2 id="form-title">Create Entry</h2>
  <form id="entryForm">
    <div class="form-group">
      <label for="firstName">First Name</label>
      <input type="text" class="form-control" id="firstName" required>
    </div>
    <div class="form-group">
      <label for="lastName">Last Name</label>
      <input type="text" class="form-control" id="lastName" required>
    </div>
    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" class="form-control" id="email" required>
    </div>
    <div class="form-group">
      <label for="mobile">Mobile</label>
      <input type="text" class="form-control" id="mobile" required>
    </div>
    <div class="form-group">
      <label for="company">Company</label>
      <input type="text" class="form-control" id="company">
    </div>
    <div class="form-group">
      <label for="dob">DOB</label>
      <input type="date" class="form-control" id="dob">
    </div>
    <div class="form-group">
      <label for="gender">Gender</label>
      <select class="form-control" id="gender">
        <option>Male</option>
        <option>Female</option>
        <option>Other</option>
      </select>
    </div>
    <div class="form-group">
      <label for="selectedImage">Image URL</label>
      <input type="url" class="form-control" id="selectedImage">
    </div>

    <button type="submit" class="btn btn-success">Submit</button>
  </form>
</div>

<!-- Firebase + Logic -->
<script type="module">
  import {
    initializeApp
  } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import {
    getDatabase,
    ref,
    push,
    update,
    get
  } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDzH5UiDJNkVd4yoKGRon9AGqmSxkY0l90",
    authDomain: "reactinternproject.firebaseapp.com",
    databaseURL: "https://reactinternproject-default-rtdb.asia-southeast1.firebasedatabase.app/",
    projectId: "reactinternproject",
    storageBucket: "reactinternproject.appspot.com",
    messagingSenderId: "12894491806",
    appId: "1:12894491806:web:97fc439319fdbfcf8d578f"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  function getURLParameter(name) {
    return new URLSearchParams(window.location.search).get(name);
  }

  const mode = getURLParameter("mode");
  const entryId = getURLParameter("id");

  if (mode === "update" && entryId) {
    document.getElementById("form-title").textContent = "Update Entry";
    const entryRef = ref(db, "formResponses/" + entryId);
    get(entryRef).then((snapshot) => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        document.getElementById("firstName").value = data.name || "";
        document.getElementById("lastName").value = data.lastName || "";
        document.getElementById("email").value = data.email || "";
        document.getElementById("mobile").value = data.mobile || "";
        document.getElementById("company").value = data.company || "";
        document.getElementById("dob").value = data.dob || "";
        document.getElementById("gender").value = data.gender || "";
        document.getElementById("selectedImage").value = data.selectedImage || "";
      }
    });
  }

  document.getElementById("entryForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = {
      name: document.getElementById("firstName").value,
      lastName: document.getElementById("lastName").value,
      email: document.getElementById("email").value,
      mobile: document.getElementById("mobile").value,
      company: document.getElementById("company").value,
      dob: document.getElementById("dob").value,
      gender: document.getElementById("gender").value,
      selectedImage: document.getElementById("selectedImage").value,
      timestamp: Date.now()
    };

    if (mode === "update" && entryId) {
      await update(ref(db, "formResponses/" + entryId), formData);
    } else {
      await push(ref(db, "formResponses"), formData);
    }

    // âœ… Close modal + refresh parent page
    window.parent.postMessage("refreshParent", "*");
  });
</script>

</body>
</html>
