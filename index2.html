<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Internship Project</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://unpkg.com/react@17/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

<style>
body { padding: 20px; }
.preview-box { border: 2px solid #000; padding: 20px; min-height: 300px; background-color: #f9f9f9; }
.carousel-wrapper { position: relative; }
.carousel-row { display: flex; overflow-x: auto; scroll-behavior: smooth; padding: 10px 30px; }
.carousel-row img { height: 150px; width: 150px; object-fit: cover; margin-right: 10px; border: 2px solid #ddd; cursor: pointer; transition: 0.3s ease; }
.carousel-row img:hover { border-color: #007bff; transform: scale(1.03); }
.arrow-btn { position: absolute; top: 50%; transform: translateY(-50%); z-index: 10; background-color: #fff; border: 1px solid #ccc; padding: 8px 12px; cursor: pointer; }
.arrow-left { left: 0; }
.arrow-right { right: 0; }
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useRef, useEffect } = React;

function App() {
  const [form, setForm] = useState({ name:"", lastName:"", email:"", mobile:"", company:"", dob:"", gender:"" });
  const [selectedImage, setSelectedImage] = useState("");
  const [currentId, setCurrentId] = useState(null);
  const carouselRef = useRef(null);

  useEffect(() => {
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    if (id) {
      const dbRef = window.firebaseRef(`formResponses/${id}`);
      window.firebaseOnValue(dbRef, (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        setForm({
          name: data.name || "",
          lastName: data.lastName || "",
          email: data.email || "",
          mobile: data.mobile || "",
          company: data.company || "",
          dob: data.dob || "",
          gender: data.gender || ""
        });
        setSelectedImage(data.selectedImage || "");
        setCurrentId(id);
      }, { onlyOnce: true });
    }
  }, []);

  const handleChange = e => setForm({ ...form, [e.target.name]: e.target.value });
  const handleImageSelect = src => setSelectedImage(src);

  const handleSubmit = () => {
    if (!form.name || !form.lastName || !form.email || !form.mobile || !form.company || !form.dob || !form.gender || !selectedImage) {
      alert("Please fill all fields & select an image.");
      return;
    }

    const userData = { ...form, selectedImage, timestamp: Date.now() };

    const dbRef = window.firebaseRef("formResponses");
    window.firebaseOnValue(dbRef, (snapshot) => {
      const data = snapshot.val() || {};
      const entries = Object.entries(data).map(([id, value]) => ({ id, ...value }));

      const duplicate = entries.find(
        e =>
          (e.email === userData.email || e.mobile === userData.mobile) &&
          e.id !== currentId
      );

      if (duplicate) {
        alert("❌ Email or Mobile already exists. Please use unique values.");
        return;
      }

      if (currentId) {
        window.firebaseUpdate(window.firebaseRef(`formResponses/${currentId}`), userData)
          .then(() => {
            alert("✅ Data updated!");
            window.parent.location.reload();
            window.parent.$('#entryModal').modal('hide');
          })
          .catch(err => {
            console.error("❌ Update failed", err);
            alert("❌ Failed to update.");
          });
      } else {
        const newRef = window.firebasePush(window.firebaseRef("formResponses"));
        window.firebaseSet(newRef, userData)
          .then(() => {
            alert("✅ Data saved!");
            window.parent.location.reload();
            window.parent.$('#entryModal').modal('hide');
          })
          .catch(err => {
            console.error("❌ Save failed", err);
            alert("❌ Failed to save.");
          });
      }
    }, { onlyOnce: true });
  };

const validateForm = () => {
  const isValid =
    form.name.trim() !== "" &&
    form.lastName.trim() !== "" &&
    form.email.trim() !== "" &&
    form.mobile.trim().length === 10 &&
    form.company.trim() !== "" &&
    form.dob.trim() !== "" &&
    form.gender.trim() !== "" &&
    selectedImage && selectedImage.trim() !== "";

  if (!isValid) {
    console.warn("Validation Failed!", form, selectedImage);
  }

  return isValid;
};

  const generatePDF = () => {
    if (!validateForm()) {
      alert("❌ Please fill in all fields and select an image before generating PDF.");
      return;
    }
    const element = document.getElementById("preview");
    html2pdf().from(element).save("profile.pdf");
  };

  const scrollCarousel = dir => {
    const scrollAmount = 200;
    if (carouselRef.current) {
      carouselRef.current.scrollBy({ left: dir==="left"?-scrollAmount:scrollAmount, behavior:"smooth" });
    }
  };

  const actorImages = Array.from({length:10},(_,i)=>`images/actor${i+1}.jpg`);

  return (
    <div className="container-fluid">
      <div className="row">
        <div className="col-md-3 border p-3">
          <h5 className="mb-3">{currentId ? "Update Entry" : "New Entry"}</h5>
          <input className="form-control mb-3" name="name" placeholder="First Name" onChange={handleChange} value={form.name}/>
          <input className="form-control mb-3" name="lastName" placeholder="Last Name" onChange={handleChange} value={form.lastName}/>
          <input className="form-control mb-3" name="email" placeholder="Email" onChange={handleChange} value={form.email}/>
          <input className="form-control mb-3" name="mobile" placeholder="Mobile" maxLength="10" onChange={e=>{
            const v = e.target.value;
            if (/^\d{0,10}$/.test(v)) setForm({...form,mobile:v});
          }} value={form.mobile}/>
          <input className="form-control mb-3" name="company" placeholder="Company" onChange={handleChange} value={form.company}/>
          <input type="date" className="form-control mb-3" name="dob" onChange={handleChange} value={form.dob}/>
          <select className="form-control mb-3" name="gender" onChange={handleChange} value={form.gender}>
            <option value="">Select Gender</option><option>Male</option><option>Female</option><option>Other</option>
          </select>
          <button className="btn btn-primary btn-block mt-2" onClick={handleSubmit}>
            {currentId ? "Update" : "Save"}
          </button>
        </div>

        <div className="col-md-9">
          <div className="border p-3 mb-3">
            <h5>Select an Image</h5>
            <div className="carousel-wrapper">
              <button className="arrow-btn arrow-left" onClick={()=>scrollCarousel("left")}>&#8592;</button>
              <div className="carousel-row" ref={carouselRef}>
                {actorImages.map((src,i)=>(
                  <img key={i} src={src} alt={`actor-${i}`} onClick={()=>handleImageSelect(src)}/>
                ))}
              </div>
              <button className="arrow-btn arrow-right" onClick={()=>scrollCarousel("right")}>&#8594;</button>
            </div>
          </div>

          <div className="d-flex justify-content-end mb-2">
            <button className="btn btn-success mr-2" onClick={generatePDF} disabled={!validateForm()}>Generate PDF</button>
          </div>

          <div className="preview-box" id="preview">
            <h4>Live Preview</h4>
            <div className="row">
              <div className="col-md-4 text-center">
                {selectedImage ? <img src={selectedImage} alt="Selected" style={{maxWidth:"100%",maxHeight:"200px"}}/>:<p>No image selected</p>}
              </div>
              <div className="col-md-4">
                <p><strong>Name:</strong> {form.name}</p>
                <p><strong>Last Name:</strong> {form.lastName}</p>
                <p><strong>Email:</strong> {form.email}</p>
                <p><strong>Mobile:</strong> {form.mobile}</p>
              </div>
              <div className="col-md-4">
                <p><strong>Company:</strong> {form.company}</p>
                <p><strong>Date of Birth:</strong> {form.dob}</p>
                <p><strong>Gender:</strong> {form.gender}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

ReactDOM.render(<App/>, document.getElementById("root"));
</script>

<script type="module" src="script.js"></script>
</body>
</html>
<!--  <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Saved Entries</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://mottie.github.io/tablesorter/css/theme.bootstrap_4.min.css" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://mottie.github.io/tablesorter/js/jquery.tablesorter.js"></script>
<script src="https://mottie.github.io/tablesorter/js/jquery.tablesorter.widgets.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.min.js"></script>

<style>
.img-thumb { width: 40px; height: 40px; object-fit: cover; }
.compact-table { font-size: 14px; width: 100%; table-layout: auto; }
.compact-table thead th { font-size: 15px; font-weight: 400; }
.compact-table th, .compact-table td { padding: 0.3rem; overflow-wrap: break-word; }
.custom-charcoal { background-color: #3b3f44; color: #fff !important; border: none; }
.custom-charcoal:hover, .custom-charcoal:focus { background-color: #2f3338; }
tbody tr:nth-child(odd) { background-color: #e6f3ff !important; }
tbody tr:hover { background-color: #d3d3d3 !important; }
.table-wrappe { width: calc(100vw - 30px); margin-left: calc(-50vw + 50% + 15px); }
.search-controls { margin-bottom: 10px; }
.delete-col { width: 5%; }
</style>
</head>

<body>
<div class="container-fluid">
<div class="table-wrappe">
<h2>Saved Entries</h2>
<div class="row search-controls">
  <div class="col-md-6 d-flex flex-wrap align-items-center gap-2">
    <button id="createEntryBtn" class="btn btn-sm custom-charcoal mr-2 mb-0">Create New Entry</button>
    <button id="toggleDeleteMode" class="btn btn-sm custom-charcoal mr-2 mb-0">Enable Delete Mode</button>
    <button id="deleteSelected" class="btn btn-danger btn-sm d-none mr-2 mb-0">Delete Selected</button>
  </div>
  <div class="col-md-6 text-right">
    <input type="text" id="searchInput" class="form-control d-inline-block w-50 mb-2" placeholder="🔍 Search...">
  </div>
</div>

<div class="table-responsive">
  <table id="entryTable" class="table table-bordered tablesorter compact-table">
    <thead class="thead-dark">
      <tr>
       <th class="delete-col d-none"><input type="checkbox" id="selectAll" /></th>
        <th>First Name ↕</th>
        <th>Last Name ↕</th>
        <th>Email ↕</th>
        <th>Mobile ↕</th>
        <th>Company ↕</th>
        <th>DOB ↕</th>
        <th>Gender ↕</th>
        <th>Image</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="table-wrappe mt-2">
<div id="pager" class="pager d-flex  margin-10px">
  <button class="btn btn-secondary btn-sm first mx-1">« First</button>
  <button class="btn btn-secondary btn-sm prev mx-1">‹ Prev</button>
  <span class="pagedisplay ml-2 mr-2"></span>
  <button class="btn btn-secondary btn-sm next mx-1">Next ›</button>
  <button class="btn btn-secondary btn-sm last mx-1">Last »</button>
</div>
</div>
</div>
</div>


<div class="modal fade" id="entryModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-body p-0">
        <iframe id="entryFrame" src="" style="width:100%; height:90vh; border:none;"></iframe>
      </div>
    </div>
  </div>
</div>

<script type="module" src="script.js"></script>

<script>
$(document).ready(function () {
  $('#createEntryBtn').on('click', () => {
    $('#entryFrame').attr('src', 'index.html');
    $('#entryModal').modal('show');
  });
  window.openUpdateModal = function(id) {
    $('#entryFrame').attr('src', `index.html?id=${id}`);
    $('#entryModal').modal('show');
  };
});
</script>
</body>
</html>
  -->
